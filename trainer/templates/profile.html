{% extends "base.html" %}

{% load i18n %}
{% load account %}
{% load static %}
{% load humanize %}
{% load widget_tweaks %}

{% block head_title %}{{trainer.username}} | {% trans "TL" %} {{level.level}}{% endblock %}
{% block section_title %}{{trainer.username}}{% endblock %}

{# {% block colour_scheme %}{% if trainer.faction.name == 'Valor' %}<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.red-deep_orange.min.css" />{% elif trainer.faction.name == 'Mystic' %}<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-deep_purple.min.css" />{% elif trainer.faction.name == 'Instinct' %}<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.amber-yellow.min.css" />{% else %}<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-green.min.css" />{% endif %}{% endblock %} #}

{% block extra_head %}
<meta name="twitter:card" content="summary"/>
<meta name="twitter:site" content="@TrainerDexApp"/>
<meta property="og:title" content="{{trainer.username}}" />
<meta property="og:image" content="{% get_static_prefix %}{{trainer.faction.image}}"/>
<meta property="og:type" content="profile" />
<meta property="og:ttl" content="345600" />
<meta property="og:description" content="Team: {{trainer.faction.name}}
Level: {{level.level}}
XP: {{xp|intcomma}}" />
<meta property="profile:username" content="{{trainer.username}}" />
<link href="{% static 'css/css-circular-prog-bar.css' %}" media="all" rel="stylesheet" />

<!-- Google Charts Data -->
    <script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script>
    <script type='text/javascript'>
      google.charts.load('current', {'packages':['annotatedtimeline']});
      google.charts.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = new google.visualization.DataTable();
        {% for update in update_history %}
          {% if forloop.first %}
          {% for field in update|slice:"3:-21" %}
              {% if field.attname == 'update_time' %}
        data.addColumn('date', 'Date');
              {% else %}
        data.addColumn('number', '{{field.readable_name}}');
              {% endif %}
            {% endfor %}
        data.addRows([
          {% if trainer.start_date %}[new Date("{{trainer.start_date|date:"c"}}"){% for field in update|slice:"4:-21" %},0{% endfor %}],{% endif %}{% endif %}
          [new {% for field in update|slice:"3:-21" %}{% if field.attname == 'update_time' %}Date("{{ field.value|date:"c" }}"){% else %},{{field.value|default_if_none:'undefined'}}{% endif %}{% if forloop.last %}]{% endif %}{% endfor %}{% if not forloop.last %},{% endif %}
         {% endfor %}
        ]);

        var chart = new google.visualization.AnnotatedTimeLine(document.getElementById('chart_div'));
        chart.draw(data, {displayAnnotations: true});
      }
    </script>


{% endblock %}

{%block content%}
<div class="mdl-grid mdl-card mdl-shadow--2dp trainerdex--profile-top {# {{trainer.faction.name.lower}} #}">
    <div class="mdl-cell mdl-cell--1-col  mdl-cell--3-offset-desktop mdl-cell--2-col-tablet mdl-cell--4-col-phone mdl-cell--gravatar-box"><img class="gravatar" src="https://www.trainerdex.co.uk/static/{{trainer.faction.image}}" /></div>
    <div class="mdl-cell mdl-cell--2-col mdl-cell--4-col-tablet mdl-cell--4-col-phone">
      <ul class="mdl-list">
        <i class="mdl-card__title-text">{{trainer.username}} {{trainer.flag_emoji|default_if_none:''}}</i>
        <li class="mdl-list__item">
          <span class="mdl-list__item-primary-content" id="start_date">
            <i class="material-icons mdl-list__item-icon">date_range</i>
            {{trainer.start_date|default_if_none:"July 2016?"}}
            {% if not trainer.start_date %}<div class="mdl-tooltip" data-mdl-for="start_date">Wild guess! Most trainers started in July 2016.</div>{% endif%}
          </span>
        </li>
        <li class="mdl-list__item">
          <span class="mdl-list__item-primary-content" id="xp">
            <i class="mdl-list__item-icon">{% trans "XP" %}</i>
            {{xp|intcomma}} | {% trans "TL" %} {{level.level}}
          </span>
        </li>
      </ul>
    </div>
    <div class="mdl-cell mdl-cell--2-col mdl-cell--4-offset-desktop mdl-cell--1-offset-tablet mdl-cell--4-col-phone" style="text-align: center;">
      {% if trainer.badge_chicago_fest_july_2017 %}
        <img id="badge_chicago_fest_july_2017" class="profile-medal" src="{% static 'img/go_fest_2017.png' %}" />
        <div class="mdl-tooltip" for="badge_chicago_fest_july_2017">
            <b>{% trans "Pokémon GO Fest 2017" %}</b><br>
            {% trans "Chicago, July 22, 2017" %}
    </div>
      {% endif %}
      {% if trainer.badge_pikachu_outbreak_yokohama_2017 %}
        <img id="badge_pikachu_outbreak_yokohama_2017" class="profile-medal" src="{% static 'img/outbreak_2017.png' %}" />
        <div class="mdl-tooltip" for="badge_pikachu_outbreak_yokohama_2017">
            <b>{% trans "Pokémon GO STADIUM" %}</b><br>
            {% trans "Yokohama, August 2017" %}
        </div>
      {% endif %}
      {% if trainer.badge_safari_zone_europe_2017_09_16 %}
        <img id="badge_safari_zone_europe_2017_09_16" class="profile-medal" src="{% static 'img/safari_zone_2017.png' %}" />
        <div class="mdl-tooltip" for="badge_safari_zone_europe_2017_09_16">
            <b>{% trans "GO Safari Zone - Europe 2017" %}</b><br>
            {% trans "Europe, September 16, 2017" %}
        </div>
      {% endif %}
      {% if trainer.badge_safari_zone_europe_2017_10_07 %}
        <img id="badge_safari_zone_europe_2017_10_07" class="profile-medal" src="{% static 'img/safari_zone_2017.png' %}" />
        <div class="mdl-tooltip" for="badge_safari_zone_europe_2017_10_07">
            <b>{% trans "GO Safari Zone - Europe 2017" %}</b><br>
            {% trans "Europe, October 7, 2017" %}
        </div>
      {% endif %}
      {% if trainer.badge_safari_zone_europe_2017_10_14 %}
        <img id="badge_safari_zone_europe_2017_10_14" class="profile-medal" src="{% static 'img/safari_zone_2017.png' %}" />
        <div class="mdl-tooltip" for="badge_safari_zone_europe_2017_10_14">
            <b>{% trans "GO Safari Zone - Europe 2017" %}</b><br>
            {% trans "Europe, October 14, 2017" %}
        </div>
      {% endif %}
      {% if trainer.badge_chicago_fest_july_2018 %}
        <img id="badge_chicago_fest_july_2018" class="profile-medal" src="{% static 'img/go_fest_2018.png' %}" />
        <div class="mdl-tooltip" for="badge_chicago_fest_july_2018">
            <b>{% trans "Pokémon GO Fest 2018" %}</b><br>
            {% trans "Chicago, July 14-15, 2018" %}
        </div>
      {% endif %}
      {% if trainer.badge_apac_partner_july_2018 %}
        <img id="badge_apac_partner_july_2018" class="profile-medal" src="{% static 'img/special_weekend_2018.png' %}" />
        <div class="mdl-tooltip" for="badge_apac_partner_july_2018">
            <b>{% trans "Pokémon GO Special Weekend" %}</b><br>
            {% trans "Japan, July 26-29, 2018" %}
        </div>
      {% endif %}
      {% for spon in sponsorships %}
        <img id="{{spon.slug}}" class="profile-medal" src="{% get_media_prefix %}{{spon.icon}}" />
        <div class="mdl-tooltip" for="{{spon.slug}}">
            <b>{{spon.title}}</b><br>
        {{spon.description}}
        </div>
      {% endfor %}
      {% if silph_card %}
        {% for badge in trainer.get_silph_card_badges %}
        <img id="silph_{{badge.slug}}" class="profile-medal" src="{{badge.image}}" />
        <div class="mdl-tooltip" for="silph_{{badge.slug}}">
            <b>{{badge.name}}</b><br>
        {{badge.description}}
        </div>
        {% endfor %}
      {% endif %}
    </div>
</div>
<div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
  <div class="mdl-tabs__tab-bar">
      <a href="#history-panel" class="mdl-tabs__tab is-active">{% trans "History" %}</a>
      <a href="#badges-panel" class="mdl-tabs__tab">{% trans "Medals" %}</a>
      <a href="#types-panel" class="mdl-tabs__tab">{% trans "Type Medals" %}</a>
      <a href="#graph-panel" class="mdl-tabs__tab">{% trans "Graph" %}</a>
  </div>

  <div class="mdl-tabs__panel is-active" id="history-panel">
    <div class="mdl-grid table-responsive">
      <table class="mdl-cell mdl-data-table mdl-js-data-table mdl-shadow--2dp trainerdex-card-center">
        {% for update in update_history %}
          {% if forloop.first %}
        <thead>
          <tr>
            {% for field in update|slice:"3:-21" %}
            <th id="{{field.attname}}">{{field.readable_name}}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% endif %}
          
          <tr id="{{update.1.value}}">
            {% for field in update|slice:"3:-21" %}
              {% if field.attname == 'update_time' %}
            <td id="{{update.1.value}}.{{field.attname}}">{{field.value|default_if_none:"---"|naturalday}}</td>
              {% else %}
            <td id="{{update.1.value}}.{{field.attname}}">{{field.value|default_if_none:"---"|intcomma}}</td>
              {% endif %}
            {% endfor %}
          </tr>
          {% if forloop.last %}
        </tbody>
          {% endif %}
        {% endfor %}
      </table>
    </div>
  </div>
  <div class="mdl-tabs__panel" id="badges-panel">
    {% trans "It seems this trainer hasn't shared any of these medals. We only show medals with data to avoid showing a row of null values, that's kinda ugly." as no_medals %}
    {% if badges %}
    <div class="mdl-grid mdl-grid--no-spacing">
      {% for badge in badges %}
      <div class="mdl-card mdl-cell mdl-shadow--2dp mdl-cell--1-col-desktop mdl-cell--2-col-tablet mdl-cell--2-col-phone trainerdex--profile__badges-individual">
        <div class="progress-circle {# {{trainer.faction.name.lower}} #} {% if badge.percent > 50 %}over50 {% endif %}p{{ badge.percent }}" id="{{ badge.name }}">
          <div class="mdl-tooltip" data-mdl-for="{{ badge.name }}">{{badge.time|naturalday}}</div>
          <span>{{ badge.value }}</span>
          <div class="left-half-clipper">
            <div class="first50-bar {# {{trainer.faction.name.lower}} #}"></div>
            <div class="value-bar {# {{trainer.faction.name.lower}} #}"></div>
          </div>
        </div>
      <span>{{ badge.readable_name }}</span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="mdl-grid">
      <div class="trainerdex-card-wide mdl-card mdl-cell mdl-shadow--2dp" style="margin-left: auto; margin-right: auto;">
        <div class="mdl-card__title">
          <h2 class="mdl-card__title-text">Oh no!</h2>
        </div>
        <div class="mdl-card__supporting-text">
          {{no_medals}}
        </div>
      </div>
    </div>
    {% endif %}
  </div>
  <div class="mdl-tabs__panel" id="types-panel">
    {% if type_badges %}
    <div class="mdl-grid mdl-grid--no-spacing">
      {% for badge in type_badges %}
      <div class="mdl-card mdl-cell mdl-shadow--2dp mdl-cell--1-col-desktop mdl-cell--2-col-tablet mdl-cell--2-col-phone trainerdex--profile__badges-individual">
        <div class="progress-circle {# {{trainer.faction.name.lower}} #} {% if badge.percent > 50 %}over50 {% endif %}p{{ badge.percent }}" id="{{ badge.name }}">
          <div class="mdl-tooltip" data-mdl-for="{{ badge.name }}">{{badge.time|naturalday}}</div>
          <span>{{ badge.value }}</span>
          <div class="left-half-clipper">
            <div class="first50-bar {# {{trainer.faction.name.lower}} #}"></div>
            <div class="value-bar {# {{trainer.faction.name.lower}} #}"></div>
          </div>
        </div>
      <span>{{ badge.readable_name }}</span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="mdl-grid">
      <div class="trainerdex-card-wide mdl-card mdl-cell mdl-shadow--2dp" style="margin-left: auto; margin-right: auto;">
        <div class="mdl-card__title">
          <h2 class="mdl-card__title-text">Oh no!</h2>
        </div>
        <div class="mdl-card__supporting-text">
          {{no_medals}}
        </div>
      </div>
    </div>
    {% endif %}
</div>
  <div class="mdl-tabs__panel" id="graph-panel">
    <div id='chart_div' style='width: 100%; height: 550px;'></div>
</div>
{% endblock %}

{% block extra_body %}
{% endblock %}
